<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Artistry Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #fffafb;
      }
      .serif {
        font-family: "Playfair Display", serif;
      }
      [x-cloak] {
        display: none !important;
      }
      .search-input:focus {
        box-shadow: 0 0 0 4px rgba(225, 29, 72, 0.1);
      }
    </style>
  </head>
  <body
    x-data="{ 
    authenticated: localStorage.getItem('admin_auth') === 'true', 
    password: '', 
    bookings: [], 
    loading: true,
    searchQuery: '',

    get filteredBookings() {
        return this.bookings.filter(b => 
            b.name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
            b.service.toLowerCase().includes(this.searchQuery.toLowerCase())
        );
    },

    async fetchBookings() {
        try {
            const res = await fetch('http://localhost:5000/api/bookings');
            this.bookings = await res.json();
        } catch (e) { console.error('Fetch error'); }
        this.loading = false;
    },

    logout() {
        localStorage.removeItem('admin_auth');
        this.authenticated = false;
        window.location.reload();
    },

    async deleteBooking(id) {
        if (confirm('üóëÔ∏è Are you sure you want to delete this booking?')) {
            try {
                const res = await fetch(`http://localhost:5000/api/bookings/${id}`, { method: 'DELETE' });
                if (res.ok) { this.bookings = this.bookings.filter(b => b._id !== id); }
            } catch (e) { alert('Error deleting booking'); }
        }
    }
}"
    x-init="if(authenticated) fetchBookings()">
    <template x-if="!authenticated">
      <div
        class="fixed inset-0 bg-rose-900/95 backdrop-blur-md z-[200] flex items-center justify-center p-6">
        <div
          class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-sm w-full border border-rose-100">
          <div class="mb-6">
            <span class="text-5xl">üîê</span>
            <h2 class="serif text-3xl text-rose-800 mt-4">Admin Portal</h2>
            <p class="text-stone-500 text-sm mt-2">
              Enter credentials to access bookings
            </p>
          </div>
          <input
            type="password"
            x-model="password"
            @keydown.enter="if(password === 'noor123') { authenticated = true; localStorage.setItem('admin_auth', 'true'); fetchBookings(); } else { alert('Incorrect Password') }"
            placeholder="Enter Password"
            class="w-full p-4 border border-rose-100 rounded-2xl mb-4 text-center focus:ring-2 focus:ring-rose-300 outline-none transition-all" />
          <div class="space-y-4">
            <button
              @click="if(password === 'noor123') { authenticated = true; localStorage.setItem('admin_auth', 'true'); fetchBookings(); } else { alert('Incorrect Password') }"
              class="w-full bg-rose-800 text-white py-4 rounded-2xl font-bold hover:bg-rose-700 transition shadow-lg shadow-rose-200">
              Login to Dashboard
            </button>
            <a
              href="artist.html"
              class="block text-stone-400 py-2 text-sm hover:text-rose-600 transition font-medium"
              >‚Üê Back to Main Webpage</a
            >
          </div>
        </div>
      </div>
    </template>

    <div x-show="authenticated" x-cloak class="max-w-6xl mx-auto p-4 md:p-8">
      <div
        class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
        <div class="text-center md:text-left">
          <h1 class="serif text-3xl md:text-4xl text-rose-800">
            Booking Requests
          </h1>
          <p class="text-stone-500 text-sm mt-1">
            Managed via MongoDB Atlas Cloud
          </p>
        </div>
        <div class="flex gap-3">
          <button
            @click="logout()"
            class="bg-white border border-stone-200 text-stone-600 px-5 py-2 rounded-full font-bold text-xs hover:bg-stone-50 transition">
            üö™ Log Out
          </button>
          <button
            @click="window.location.reload()"
            class="bg-rose-800 text-white px-6 py-2 rounded-full font-bold text-xs shadow-md hover:bg-rose-700 transition">
            üîÑ Refresh
          </button>
        </div>
      </div>

      <div class="mb-6 relative">
        <span
          class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-rose-300"
          >search</span
        >
        <input
          type="text"
          x-model="searchQuery"
          placeholder="Search by name or service..."
          class="search-input w-full pl-12 pr-4 py-4 bg-white border border-rose-100 rounded-2xl outline-none transition-all text-sm text-stone-700 shadow-sm" />
      </div>

      <div
        class="bg-white rounded-3xl shadow-xl border border-rose-100 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full min-w-[700px] text-left border-collapse">
            <thead
              class="bg-rose-50 text-rose-800 uppercase text-[10px] tracking-widest font-bold">
              <tr>
                <th class="px-6 py-5 border-b border-rose-100">Client</th>
                <th class="px-6 py-5 border-b border-rose-100">Service(s)</th>
                <th class="px-6 py-5 border-b border-rose-100">Schedule</th>
                <th class="px-6 py-5 border-b border-rose-100">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-rose-50">
              <template x-for="booking in filteredBookings" :key="booking._id">
                <tr class="hover:bg-rose-50/30 transition">
                  <td class="px-6 py-5">
                    <div
                      class="font-bold text-stone-800"
                      x-text="booking.name"></div>
                    <div
                      class="text-xs text-stone-400"
                      x-text="booking.email"></div>
                  </td>
                  <td class="px-6 py-5">
                    <span
                      class="bg-rose-100 text-rose-700 px-3 py-1 rounded-full text-[10px] font-bold"
                      x-text="booking.service"></span>
                  </td>
                  <td class="px-6 py-5">
                    <div
                      class="font-bold text-stone-800 text-sm"
                      x-text="booking.date"></div>
                    <div
                      class="text-xs text-rose-400"
                      x-text="booking.time"></div>
                  </td>
                  <td class="px-6 py-5">
                    <div class="flex items-center gap-4">
                      <a
                        :href="'https://wa.me/91' + booking.phone + '?text=Hi ' + booking.name + ', this is Artistry Studio...'"
                        target="_blank"
                        class="text-emerald-500 hover:scale-110 transition flex items-center gap-1">
                        <span class="material-symbols-outlined">chat</span>
                        <span class="text-[10px] font-bold">CONTACT</span>
                      </a>
                      <button
                        @click="deleteBooking(booking._id)"
                        class="text-rose-200 hover:text-rose-600 transition">
                        <span class="material-symbols-outlined">delete</span>
                      </button>
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
        <div x-show="loading" class="p-20 text-center text-rose-300 italic">
          Fetching Cloud Data...
        </div>
        <div
          x-show="!loading && filteredBookings.length === 0"
          class="p-20 text-center text-stone-400 italic">
          No bookings found matching your search.
        </div>
      </div>

      <div class="mt-10 text-center">
        <a
          href="artist.html"
          class="text-rose-300 text-[10px] uppercase tracking-widest hover:text-rose-800 transition"
          >‚Üê Return to Portfolio</a
        >
      </div>
    </div>
  </body>
</html>
